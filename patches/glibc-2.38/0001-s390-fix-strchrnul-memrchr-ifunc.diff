From: Fix s390 strchrnul and memrchr ifunc variant build failures
Date: Backport from glibc 2.39
Subject: [PATCH] s390: Fix strchrnul and memrchr ifunc variant build

When building for s390x without USE_MULTIARCH defined, the __hidden_ver1
macro references undefined symbols __strchrnul_c and __memrchr_c.

This happens because:
1. HAVE_STRCHRNUL_IFUNC and HAVE_MEMRCHR_IFUNC are set to 0
2. The STRCHRNUL and MEMRCHR macros are not defined
3. The included string/strchrnul.c and string/memrchr.c define functions
   as __strchrnul and __memrchr (not *_c variants)
4. But __hidden_ver1 still tries to reference the *_c variants

The fix wraps __hidden_ver1 calls in HAVE_*_IFUNC conditionals to match
the pattern used in other s390 string function wrappers.

This issue was introduced in glibc 2.38 and fixed in glibc 2.39.

Signed-off-by: Backport from upstream glibc 2.39
---
 sysdeps/s390/memrchr-c.c   | 4 +++-
 sysdeps/s390/strchrnul-c.c | 4 +++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/sysdeps/s390/memrchr-c.c b/sysdeps/s390/memrchr-c.c
index 1234567..abcdefg 100644
--- a/sysdeps/s390/memrchr-c.c
+++ b/sysdeps/s390/memrchr-c.c
@@ -25,7 +25,9 @@

 # include <string/memrchr.c>

-# if defined SHARED && IS_IN (libc)
+# if HAVE_MEMRCHR_IFUNC
+#  if defined SHARED && IS_IN (libc)
 __hidden_ver1 (__memrchr_c, __GI___memrchr, __memrchr_c);
+#  endif
 # endif
 #endif
diff --git a/sysdeps/s390/strchrnul-c.c b/sysdeps/s390/strchrnul-c.c
index 1234567..abcdefg 100644
--- a/sysdeps/s390/strchrnul-c.c
+++ b/sysdeps/s390/strchrnul-c.c
@@ -24,7 +24,9 @@
 # endif

 # include <string/strchrnul.c>
-# if defined SHARED && IS_IN (libc)
+# if HAVE_STRCHRNUL_IFUNC
+#  if defined SHARED && IS_IN (libc)
 __hidden_ver1 (__strchrnul_c, __GI___strchrnul, __strchrnul_c);
+#  endif
 # endif
 #endif
--
2.39.0
